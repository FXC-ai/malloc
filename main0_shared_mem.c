#include "libft/libft.h"
#include <stdio.h>
#include <sys/mman.h>

void *ft_malloc (int size)
{
	void *ptr;

	ptr = mmap(NULL, size, PROT_READ | PROT_WRITE, MAP_SHARED | MAP_ANONYMOUS, -1, 0);
	if (shared_mem == MAP_FAILED) {
		return NULL;
	}
	return ptr;
}


int main()
{

	printf("PID = %d\n", getpid());
	size_t len = 9000;

	char *shared_mem = mmap(NULL, len, PROT_READ | PROT_WRITE, MAP_SHARED | MAP_ANONYMOUS, -1, 0);
	if (shared_mem == MAP_FAILED) {
		perror("mmap");
		exit(EXIT_FAILURE);
	}

	const char *message = "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789";
	strcpy(shared_mem, message);
	printf("processus 0 a ecrit à la l'adresse %p : %s\n", shared_mem, shared_mem);

	char * cpy_ptr = shared_mem;

	void *ptr = malloc(128);

	printf("ptr = %p\n", ptr);

	printf("processus 0 a ecrit à la l'adresse %p : %s\n", cpy_ptr, cpy_ptr);

	while (1)
	{}

	return 0;
}